<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hellobox HK</title>
  </head>
  <body>
    <h2>è¨‚è³¼ HelloBox</h2>

    <div id="productList"></div>
    <button onclick="addProduct()">â• å¢åŠ ä¸€ä»¶ç”¢å“</button>
    <br /><br />
    <button onclick="checkout()">ä¸‹ä¸€æ­¥ï¼šè·³å» WhatsApp</button>

    <script>
      const cloudName = "helloboxhk";
      const uploadPreset = "hellobox_unsigned";
      const productList = document.getElementById("productList");
      let productIndex = 0;

      function addProduct() {
        const div = document.createElement("div");
        div.innerHTML = `
        <h4>ç”¢å“ ${productIndex + 1}</h4>
        <label>ç›¸ç‰‡ï¼š</label><input type="file" class="photo"><br>
        <label>YouTube é€£çµï¼š</label><input type="url" class="youtube"><br><br>
      `;
        productList.appendChild(div);
        productIndex++;
      }

      async function uploadImage(file) {
        const formData = new FormData();
        formData.append("file", file);
        formData.append("upload_preset", uploadPreset);
        const res = await fetch(
          `https://api.cloudinary.com/v1_1/${cloudName}/image/upload`,
          {
            method: "POST",
            body: formData,
          }
        );
        const data = await res.json();
        return data.secure_url;
      }

      async function checkout() {
        const orderRef = "HB-" + new Date().getTime();
        const photoInputs = document.querySelectorAll(".photo");
        const youtubeInputs = document.querySelectorAll(".youtube");

        let message = `Hello ğŸ‘‹ æˆ‘æƒ³è¨‚è³¼ HelloBox\nè¨‚å–®ç·¨è™Ÿï¼š${orderRef}\n`;

        for (let i = 0; i < photoInputs.length; i++) {
          const file = photoInputs[i].files[0];
          const youtube = youtubeInputs[i].value || "(æœªå¡«)";

          if (!file) {
            alert(`ç¬¬ ${i + 1} ä»¶ç”¢å“ï¼šè«‹é¸ç›¸ç‰‡`);
            return;
          }

          const imageUrl = await uploadImage(file);
          message += `\nğŸ§¸ ç”¢å“ ${
            i + 1
          }ï¼š\nğŸ–¼ ç›¸ç‰‡ï¼š${imageUrl}\nğŸµ YouTubeï¼š${youtube}\n`;
        }

        const encoded = encodeURIComponent(message);
        window.location.href = `https://wa.me/85263783481?text=${encoded}`;
      }

      // é è¨­å…ˆåŠ ä¸€ä»¶
      addProduct();
    </script>
  </body>
</html>
